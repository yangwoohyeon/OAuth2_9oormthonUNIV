<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>WebSocket ì±„íŒ… í…ŒìŠ¤íŠ¸</title>
</head>
<body>
<h2>ì±„íŒ… í…ŒìŠ¤íŠ¸</h2>
<div>
    <label>Access Token: <input type="text" id="token" /></label><br>
    <label>ë³´ë‚´ëŠ” ì‚¬ëŒ ID: <input type="text" id="senderId" /></label><br>
    <label>ë°›ëŠ” ì‚¬ëŒ ID: <input type="text" id="receiverId" /></label><br>
    <label>ì±„íŒ…ë°© ID: <input type="number" id="chatRoomId" /></label><br>
    <label>ë©”ì‹œì§€ ë‚´ìš©: <input type="text" id="message" /></label><br>
    <button onclick="connectWebSocket()">WebSocket ì—°ê²°</button>
    <button onclick="sendJoin()">JOIN</button>
    <button onclick="sendMessage()">TALK</button>
    <button onclick="sendLeave()">LEAVE</button>
</div>

<h3>ì±„íŒ… ë¡œê·¸</h3>
<pre id="chatLog" style="background:#eee; padding:10px; height:300px; overflow-y:scroll;"></pre>

<script>
    let socket;

    function connectWebSocket() {
        const token = document.getElementById("token").value;
        const socketUrl = "ws://localhost:8080/ws/conn?token=" + encodeURIComponent(token);
        socket = new WebSocket(socketUrl); // âœ… query íŒŒë¼ë¯¸í„° ë°©ì‹


        socket.onopen = () => log("âœ… WebSocket ì—°ê²°ë¨");
        socket.onmessage = (event) => log("ğŸ“© " + event.data);
        socket.onclose = () => log("âŒ ì—°ê²° ì¢…ë£Œë¨");
        socket.onerror = (e) => log("âš ï¸ ì—ëŸ¬ ë°œìƒ: " + e);
    }




    function sendJoin() {
        const msg = createMessage("JOIN");
        socket.send(JSON.stringify(msg));
    }

    function sendMessage() {
        const msg = createMessage("TALK");
        socket.send(JSON.stringify(msg));
    }

    function sendLeave() {
        const msg = createMessage("LEAVE");
        socket.send(JSON.stringify(msg));
    }

    function createMessage(type) {
        return {
            messageType: type,
            chatRoomId: parseInt(document.getElementById("chatRoomId").value),
            senderId: document.getElementById("senderId").value,
            receiverId: document.getElementById("receiverId").value,
            message: document.getElementById("message").value
        };
    }

    function log(message) {
        const logArea = document.getElementById("chatLog");
        logArea.textContent += message + "\n";
        logArea.scrollTop = logArea.scrollHeight;
    }
</script>
</body>
</html>
